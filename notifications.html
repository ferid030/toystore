<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="images/favicon.jpg">
    <title>Bildiri≈ül…ôr - Toys Market</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/modern.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .notifications-wrapper {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .notif-item {
            display: flex;
            gap: 20px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .notif-item::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-color);
        }

        .notif-item.unread {
            background: rgba(255, 71, 87, 0.03);
            border: 1px solid rgba(255, 71, 87, 0.1);
        }

        .notif-item.success::after {
            background: var(--success-color);
        }

        .notif-item.info::after {
            background: var(--info-color);
        }

        .notif-item.warning::after {
            background: var(--warning-color);
        }

        .notif-icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }

        .notif-content {
            flex: 1;
        }

        .notif-content h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .notif-content p {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .notif-time {
            font-size: 0.8rem;
            color: #999;
            margin-top: 10px;
            display: block;
        }

        .empty-notifications {
            text-align: center;
            padding: 100px 0;
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <div id="preloader">
        <div class="loader-toy">üîî</div>
    </div>

    <div id="app"></div>

    <header class="page-header">
        <div class="container">
            <h1>Bildiri≈ül…ôriniz üì¨</h1>
            <p>Sifari≈ü statuslarƒ± v…ô x√ºsusi t…ôklifl…ôr haqqƒ±nda m…ôlumatlar.</p>
        </div>
    </header>

    <main class="notifications-wrapper">
        <div id="notifications-list">
            <!-- Notifications injected here -->
        </div>
    </main>

    <script type="module">
        import { supabase } from './js/supabase.js';
        import { renderNavbar, renderFooter, Loader, Toast } from './js/components.js';
        import { getCurrentUser } from './js/auth.js';
        import { reveal, initPreloader } from './js/animations.js';

        async function init() {
            initPreloader();
            const user = await getCurrentUser();
            if (!user) {
                window.location.href = '/login.html';
                return;
            }
            document.getElementById('app').appendChild(renderNavbar(user));
            document.body.appendChild(renderFooter());

            await loadNotifications(user.id);
            window.addEventListener('scroll', reveal);
            reveal();
        }

        async function loadNotifications(userId) {
            const { data: notifications, error } = await supabase
                .from('notifications')
                .select('*')
                .eq('user_id', userId)
                .order('created_at', { ascending: false });

            const container = document.getElementById('notifications-list');

            if (error || !notifications || notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-notifications reveal">
                        <span style="font-size: 5rem;">üì≠</span>
                        <h2 style="margin-top: 20px;">H…ôl…ô ki bildiri≈ü yoxdur.</h2>
                    </div>
                `;
                return;
            }

            container.innerHTML = notifications.map((notif, idx) => {
                const timeAgo = getTimeAgo(new Date(notif.created_at));
                let icon = 'üîî';
                if (notif.type === 'success') icon = '‚úÖ';
                if (notif.type === 'info') icon = '‚ÑπÔ∏è';
                if (notif.type === 'warning') icon = '‚ö†Ô∏è';
                if (notif.type === 'error') icon = '‚ùå';

                return `
                    <div class="glass-card notif-item reveal ${!notif.is_read ? 'unread' : ''} ${notif.type}" style="transition-delay: ${idx * 100}ms;">
                        <div class="notif-icon-circle">${icon}</div>
                        <div class="notif-content">
                            <h4>${notif.title}</h4>
                            <p>${notif.message}</p>
                            <span class="notif-time">${timeAgo}</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Mark as read after delay
            setTimeout(async () => {
                await supabase
                    .from('notifications')
                    .update({ is_read: true })
                    .eq('user_id', userId)
                    .eq('is_read', false);
            }, 3000);
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'ƒ∞ndic…ô';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' d…ôqiq…ô …ôvv…ôl';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' saat …ôvv…ôl';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' g√ºn …ôvv…ôl';
            return date.toLocaleDateString('az-AZ');
        }

        init();
    </script>
</body>

</html>