<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="images/favicon.jpg">
    <title>Ä°stifadÉ™Ã§ilÉ™r - Admin Panel</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/modern.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="preloader">
        <div class="loader-toy">ğŸ‘¥</div>
    </div>

    <div class="admin-layout">
        <aside class="admin-sidebar">
            <h2>Toys Market</h2>
            <nav class="admin-nav">
                <a href="admin.html"><span>ğŸ“Š</span> <span>Dashboard</span></a>
                <a href="admin-toys.html"><span>ğŸ§¸</span> <span>Oyuncaqlar</span></a>
                <a href="admin-receipts.html"><span>ğŸ§¾</span> <span>QÉ™bzlÉ™r</span></a>
                <a href="admin-users.html" class="active"><span>ğŸ‘¥</span> <span>Ä°stifadÉ™Ã§ilÉ™r</span></a>
                <a href="admin-orders.html"><span>ğŸ“¦</span> <span>SifariÅŸlÉ™r</span></a>
                <hr style="opacity: 0.1; margin: 10px 0;">
                <a href="/"><span>ğŸ </span> <span>Sayta QayÄ±t</span></a>
            </nav>
        </aside>

        <main class="admin-main">
            <header class="admin-header reveal">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 800;">Ä°stifadÉ™Ã§i BazasÄ± ğŸ‘¥</h1>
                    <p style="color: var(--text-muted);">Platformada qeydiyyatdan keÃ§É™n bÃ¼tÃ¼n istifadÉ™Ã§ilÉ™r.</p>
                </div>
            </header>

            <div class="admin-table-container reveal" style="transition-delay: 200ms;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Ad Soyad</th>
                            <th>Elektron PoÃ§t</th>
                            <th>Tocoin BalansÄ±</th>
                            <th>Ä°stifadÉ™Ã§i Rolu</th>
                            <th>ÆmÉ™liyyat</th>
                        </tr>
                    </thead>
                    <tbody id="users-list">
                        <!-- Data goes here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script type="module">
        import { supabase } from './js/supabase.js';
        import { checkAdmin, AdminUsers } from './js/admin.js';
        import { reveal, initPreloader } from './js/animations.js';

        async function init() {
            initPreloader();
            await checkAdmin();
            await loadUsers();
            window.addEventListener('scroll', reveal);
            reveal();
        }

        async function loadUsers() {
            const { data: users } = await supabase.from('users').select('*').order('created_at', { ascending: false });
            const container = document.getElementById('users-list');

            if (!users || users.length === 0) {
                container.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; opacity: 0.5;">Ä°stifadÉ™Ã§i tapÄ±lmadÄ±.</td></tr>';
                return;
            }

            container.innerHTML = users.map(user => `
                <tr>
                    <td style="font-weight: 700;">${user.full_name || 'Qeyd olunmayÄ±b'}</td>
                    <td style="color: var(--text-muted);">${user.email}</td>
                    <td><span style="color:var(--secondary-color); font-weight:700;">ğŸ’° ${user.tocoin_balance} TCN</span></td>
                    <td><span class="badge ${user.role === 'admin' ? 'paid' : 'pending'}" style="text-transform: capitalize;">${user.role}</span></td>
                    <td>
                        <button onclick="changeBalance('${user.id}', ${user.tocoin_balance})" class="btn btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">Balans +/-</button>
                    </td>
                </tr>
            `).join('');

            window.changeBalance = (id, currentBalance) => {
                const newBalance = prompt('Yeni balans miqdarÄ±nÄ± daxil edin:', currentBalance);
                if (newBalance !== null) {
                    AdminUsers.updateBalance(id, newBalance);
                    setTimeout(loadUsers, 1000);
                }
            };
        }

        init();
    </script>
</body>

</html>